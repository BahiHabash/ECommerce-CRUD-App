<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Mini Postman (Dark)</title>
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css"
    />
    <style>
      body {
        font-family: Arial, sans-serif;
        background: #1e1e1e;
        color: #f5f5f5;
        margin: 0;
        padding: 2rem;
      }
      .container {
        max-width: 900px;
        margin: auto;
        background: #2b2b2b;
        padding: 2rem;
        border-radius: 12px;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.4);
      }
      h2 {
        text-align: center;
        margin-bottom: 1.5rem;
        color: #f5f5f5;
      }
      .request-bar {
        display: flex;
        gap: 0.5rem;
        align-items: center;
      }
      select#method {
        width: 110px;
        padding: 0.6rem;
        border: 1px solid #444;
        border-radius: 6px;
        font-size: 0.9rem;
        background: #3b3b3b;
        color: #f5f5f5;
      }
      input#url {
        flex: 1;
        padding: 0.6rem;
        border: 1px solid #444;
        border-radius: 6px;
        font-size: 1rem;
        background: #3b3b3b;
        color: #f5f5f5;
      }
      button#sendBtn {
        padding: 0.6rem 1.2rem;
        border: none;
        border-radius: 6px;
        background: #0078ff;
        color: #fff;
        font-size: 1rem;
        cursor: pointer;
      }
      button#sendBtn:hover {
        background: #005fcc;
      }
      details {
        margin-top: 1rem;
      }
      details summary {
        cursor: pointer;
        font-weight: bold;
        margin-bottom: 0.5rem;
        color: #ddd;
      }
      input,
      textarea {
        width: 100%;
        padding: 0.6rem;
        border: 1px solid #444;
        border-radius: 6px;
        font-size: 0.9rem;
        margin-bottom: 1rem;
        background: #3b3b3b;
        color: #f5f5f5;
      }
      textarea {
        min-height: 80px;
        font-family: monospace;
      }
      .response {
        margin-top: 2rem;
      }
      .status {
        font-weight: bold;
        margin-bottom: 1rem;
        padding: 0.5rem 1rem;
        border-radius: 6px;
        display: inline-block;
      }
      .status.success {
        background: #153d2e;
        color: #4caf50;
        border: 1px solid #4caf50;
      }
      .status.error {
        background: #3d1e1e;
        color: #f44336;
        border: 1px solid #f44336;
      }
      pre {
        background: #1e1e1e;
        color: #f5f5f5;
        padding: 1rem;
        border-radius: 8px;
        white-space: pre-wrap;
        word-wrap: break-word;
        overflow-x: auto;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <h2>Mini Postman (Dark)</h2>

      <!-- Request Bar -->
      <div class="request-bar">
        <select id="method">
          <option value="GET" selected>GET</option>
          <option value="POST">POST</option>
          <option value="PUT">PUT</option>
          <option value="PATCH">PATCH</option>
          <option value="DELETE">DELETE</option>
          <option value="HEAD">HEAD</option>
          <option value="OPTIONS">OPTIONS</option>
        </select>
        <input
          type="text"
          id="url"
          placeholder="http://localhost:5050/api/endpoint"
        />
        <button id="sendBtn">Send</button>
      </div>

      <!-- Bearer Token -->
      <details>
        <summary>Bearer Token</summary>
        <input type="text" id="token" placeholder="your-jwt-token" />
      </details>

      <!-- Headers -->
      <details>
        <summary>Headers (JSON format)</summary>
        <textarea
          id="headers"
          placeholder='{ "Content-Type": "application/json" }'
        ></textarea>
      </details>

      <!-- Body (disabled since GET doesnâ€™t need it) -->
      <details open>
        <summary>Body (JSON format)</summary>
        <textarea
          id="body"
          placeholder="GET requests donâ€™t use a body"
        ></textarea>
      </details>

      <!-- Response -->
      <div class="response">
        <div class="status" id="status">Status: -</div>
        <pre><code id="responseBox" class="json">Response will appear here...</code></pre>
      </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script>
      hljs.highlightAll();

      document.getElementById('sendBtn').addEventListener('click', async () => {
        const url = document.getElementById('url').value.trim();
        const method = document.getElementById('method').value; // ðŸ”¥ dynamic method
        const token = document.getElementById('token').value.trim();
        const headersInput = document.getElementById('headers').value.trim();
        const bodyInput = document.getElementById('body')?.value.trim();

        let headers = {};
        try {
          if (headersInput) headers = JSON.parse(headersInput);
        } catch (err) {
          return alert('Invalid JSON in headers');
        }

        if (token) {
          headers['Authorization'] = 'Bearer ' + token;
        }

        let options = { method, headers };

        // Only attach body if method allows it
        if (['POST', 'PUT', 'PATCH'].includes(method) && bodyInput) {
          try {
            options.body = JSON.stringify(JSON.parse(bodyInput));
            headers['Content-Type'] =
              headers['Content-Type'] || 'application/json';
          } catch {
            return alert('Invalid JSON in body');
          }
        }

        try {
          const res = await fetch(url, options);
          const text = await res.text();

          const statusEl = document.getElementById('status');
          if (res.ok) {
            statusEl.className = 'status success';
          } else {
            statusEl.className = 'status error';
          }
          statusEl.textContent = `Status: ${res.status} ${res.statusText}`;

          const responseEl = document.getElementById('responseBox');
          try {
            const json = JSON.parse(text);
            responseEl.textContent = JSON.stringify(json, null, 2);
            responseEl.className = 'json';
          } catch {
            responseEl.textContent = text;
            responseEl.className = 'plaintext';
          }
          hljs.highlightElement(responseEl);
        } catch (err) {
          const statusEl = document.getElementById('status');
          statusEl.className = 'status error';
          statusEl.textContent = 'Error: Request failed';

          const responseEl = document.getElementById('responseBox');
          responseEl.textContent = err.message;
          responseEl.className = 'plaintext';
        }
      });
    </script>
  </body>
</html>
